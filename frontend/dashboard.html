
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rockfall Prediction System</title>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@200;300;400;500&display=swap" rel="stylesheet">


    <style>
        :root {
            --dark-bg: #0a0a0a;
            --main-bg: rgba(28, 28, 28, 0.6);
            --card-bg: rgba(40, 40, 40, 0.7);
            --primary-text: #e0e6e0; /* Light green-grey for main text */
            --secondary-text: #9ab09a; /* Muted green-grey for secondary text */
            --accent-color: #3b7b3b; /* Darker forest green */
            --border-color: rgba(68, 80, 68, 0.5); /* Greenish border */

            /* Gradient Colors (for the moving background) */
            --gradient-color-1: #2a3a2a; /* Deep forest green */
            --gradient-color-2: #1a2a1a; /* Even deeper forest green */
            --gradient-color-3: #4a6a4a; /* Slightly lighter green */

            --mouse-x: 50%;
            --mouse-y: 50%;
        }

        html {
            scroll-behavior: smooth;
            scroll-snap-type: y mandatory;
            scroll-padding-top: 80px;
        }

        body {
            background-color: var(--dark-bg);
            font-family: 'Jost', sans-serif;
            font-weight: 300;
            margin: 0;
            color: var(--primary-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        #root {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* --- Dynamic Background Container --- */
        .dynamic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background-size: 200% 200%, 200% 200%, 100px 100px;
            background-position: var(--mouse-x) var(--mouse-y), calc(100% - var(--mouse-x)) calc(100% - var(--mouse-y)), 0 0;
            background-image:
                radial-gradient(at var(--mouse-x) var(--mouse-y), var(--gradient-color-3) 0%, transparent 50%),
                radial-gradient(at calc(100% - var(--mouse-x)) calc(100% - var(--mouse-y)), var(--gradient-color-1) 0%, transparent 70%),
                url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><filter id="f"><feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" result="noise" /><feColorMatrix in="noise" type="matrix" values="0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.2 0" /></filter><rect width="100%" height="100%" filter="url(%23f)" opacity="0.1" /></svg>');
            animation: backgroundPan 30s linear infinite;
            transition: background-position 0.1s ease-out;
        }

        @keyframes backgroundPan {
            0% { background-position: 0% 0%, 100% 100%, 0 0; }
            50% { background-position: 100% 100%, 0% 0%, 0 0; }
            100% { background-position: 0% 0%, 100% 100%, 0 0; }
        }

        /* --- Navbar Styles --- */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: rgba(10, 20, 10, 0.5); /* Greenish semi-transparent */
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            box-sizing: border-box;
        }
        .navbar-title {
            font-size: 1.2rem;
            font-weight: 400;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        .navbar-button {
            background-color: transparent;
            color: var(--secondary-text);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            font-weight: 400;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            border-radius: 5px;
        }
        .navbar-button:hover {
            background-color: var(--accent-color);
            color: var(--dark-bg);
        }

        /* --- Hero Section --- */
        .hero {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100vh;
            padding: 0 2rem;
            box-sizing: border-box;
            scroll-snap-align: start;
        }
        .hero-title {
            font-size: 5rem;
            font-weight: 200;
            letter-spacing: 2px;
            margin: 0;
            text-transform: uppercase;
        }
        .hero-subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            color: var(--secondary-text);
            max-width: 600px;
            margin: 1.5rem auto 0 auto;
            line-height: 1.7;
        }

        /* --- Main Content Layout --- */
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            padding: 6rem 0;
            background-color: var(--main-bg);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--border-color);
            scroll-snap-align: start;
            min-height: 100vh;
            box-sizing: border-box;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 2rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            padding: 2.5rem;
            background-color: var(--main-bg);
        }

        h3 {
            color: var(--primary-text);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 400;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .prediction-form {
            padding: 2rem;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            backdrop-filter: blur(8px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .form-group label {
            font-weight: 400;
            color: var(--secondary-text);
            letter-spacing: 0.8px;
            font-size: 1rem;
            display: flex;
            align-items: baseline;
            text-transform: capitalize;
        }

        .predict-button {
            margin-top: 2.5rem;
            padding: 0.8rem 1.8rem;
            width: 100%;
            font-size: 1.1rem;
            background-color: transparent;
            color: var(--accent-color); /* Button text uses accent color */
            border: 1px solid var(--accent-color);
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-family: 'Jost', sans-serif;
            font-weight: 500;
            text-transform: uppercase;
            border-radius: 8px;
        }

        .predict-button:hover {
            background-color: var(--accent-color);
            color: var(--dark-bg); /* Text becomes dark on hover */
        }

        .predict-button:disabled {
            color: var(--secondary-text);
            border-color: var(--border-color);
            cursor: wait;
        }

        .predict-button:disabled:hover {
            background-color: transparent;
        }


        .result-container {
            margin-top: 2.5rem;
            padding: 2rem;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(8px);
        }

        .result-container .high-risk {
            color: var(--accent-color); /* High risk also uses accent green */
            font-weight: 500;
        }

        .result-container .low-risk {
            color: var(--secondary-text);
        }

        .result-container p {
            font-size: 1.1rem;
            margin: 0.8rem 0;
            letter-spacing: 0.5px;
        }

        /* --- Inline Editable Input Styles --- */
        .inline-input {
            background: transparent;
            border: none;
            color: var(--accent-color); /* Input value color */
            font-family: 'Jost', sans-serif;
            font-weight: 400;
            font-size: 1rem;
            width: 80px;
            padding: 2px 5px;
            margin-left: 0.5rem;
            border-bottom: 1px solid transparent;
            transition: background-color 0.2s, border-color 0.2s;
            text-align: right;
        }
        .inline-input:focus,
        .inline-input:hover {
            background-color: rgba(60, 100, 60, 0.1); /* Subtle green hover */
            border-bottom-color: var(--border-color);
            outline: none;
            border-radius: 4px;
        }
        .inline-input::-webkit-outer-spin-button,
        .inline-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .inline-input[type=number] {
            -moz-appearance: textfield;
        }

        /* --- Custom Slider Styles --- */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            margin: 0;
            padding: 0;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            cursor: pointer;
            background: var(--border-color);
            border-radius: 2px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            margin-top: -7px;
            transition: background-color 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            background-color: #6a9a6a; /* Lighter green on hover */
        }

        input[type=range]::-moz-range-track {
            width: 100%;
            height: 2px;
            cursor: pointer;
            background: var(--border-color);
            border-radius: 2px;
        }

        input[type=range]::-moz-range-thumb {
            height: 16px;
            width: 16px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        input[type=range]::-moz-range-thumb:hover {
            background-color: #6a9a6a;
        }

        /* --- Footer Styles --- */
        .site-footer {
            padding: 1.5rem;
            text-align: center;
            color: var(--secondary-text);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-color);
            background-color: rgba(10, 20, 10, 0.5); /* Greenish semi-transparent */
            backdrop-filter: blur(15px);
            box-sizing: border-box;
            letter-spacing: 0.5px;
            z-index: 1;
            position: relative;
        }

    </style>
</head>
<body>

    <div class="dynamic-background" id="dynamic-bg"></div>
    <div id="root"></div>

    <script type="text/babel">

        const { useState, useEffect } = React;

        // --- Component: Navbar ---
        function Navbar() {
            return (
                <nav className="navbar">
                    <div className="navbar-title">RPS</div>
                    <button className="navbar-button">About</button>
                </nav>
            );
        }

        // --- Component: Hero Section ---
        function HeroSection() {
            return (
                <section className="hero">
                    <div className="hero-content">
                        <h1 className="hero-title">Rockfall Prediction</h1>
                        <p className="hero-subtitle">
                            An interactive tool for assessing geological stability.
                            Adjust the parameters below to calculate the real-time probability of a rockfall event.
                        </p>
                    </div>
                </section>
            );
        }

        function PredictionForm({ onPrediction }) {
            const [features, setFeatures] = useState({
                slope_angle: 40.0,
                rainfall_last_24h: 100.0,
                displacement_rate: 2.0,
                pore_pressure: 150.0,
                image_crack_score: 0.5,
            });
            const [isLoading, setIsLoading] = useState(false);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                const numericValue = value === '' ? 0 : parseFloat(value);
                setFeatures(prevFeatures => ({
                    ...prevFeatures,
                    [name]: numericValue,
                }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setIsLoading(true);
                onPrediction(null); // Clear previous results

                // --- REAL API CALL to your FastAPI backend ---
                fetch("http://127.0.0.1:8000/predict", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(features),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Received real response:", data);
                    onPrediction(data);
                })
                .catch(error => {
                    console.error("Error making prediction:", error);
                    onPrediction({ error: "Failed to connect to the API. Is the server running?" });
                })
                .finally(() => {
                    setIsLoading(false); // Stop loading indicator
                });
            };

            const inputParams = {
                slope_angle: { min: 0, max: 90, step: 0.5 },
                rainfall_last_24h: { min: 0, max: 300, step: 1 },
                displacement_rate: { min: 0, max: 10, step: 0.1 },
                pore_pressure: { min: 0, max: 500, step: 5 },
                image_crack_score: { min: 0, max: 1, step: 0.01 },
            }

            return (
                <div className="prediction-form">
                    <h3>Input Parameters</h3>
                    <form onSubmit={handleSubmit}>
                        <div className="form-grid">
                            {Object.keys(features).map(key => (
                                <div key={key} className="form-group">
                                    <label>
                                        {key.replace(/_/g, ' ')}
                                        <input
                                            type="number"
                                            className="inline-input"
                                            name={key}
                                            value={features[key]}
                                            onChange={handleInputChange}
                                            min={inputParams[key].min}
                                            max={inputParams[key].max}
                                            step={inputParams[key].step}
                                            disabled={isLoading}
                                        />
                                    </label>
                                    <input
                                        type="range"
                                        name={key}
                                        value={features[key]}
                                        onChange={handleInputChange}
                                        min={inputParams[key].min}
                                        max={inputParams[key].max}
                                        step={inputParams[key].step}
                                        disabled={isLoading}
                                    />
                                </div>
                            ))}
                        </div>
                        <button type="submit" className="predict-button" disabled={isLoading}>
                            {isLoading ? 'Calculating...' : 'Calculate Risk'}
                        </button>
                    </form>
                </div>
            );
        }


        // --- Component: Footer ---
        function Footer() {
            return (
                <footer className="site-footer">
                    <p>&copy; 2025 Rockfall Prediction Systems</p>
                </footer>
            );
        }

        // --- Main App Component ---
        function App() {
            useEffect(() => {
                const handleMouseMove = (e) => {
                    const bg = document.getElementById('dynamic-bg');
                    if (bg) {
                        const x = e.clientX / window.innerWidth * 100;
                        const y = e.clientY / window.innerHeight * 100;
                        bg.style.setProperty('--mouse-x', `${x}%`);
                        bg.style.setProperty('--mouse-y', `${y}%`);
                    }
                };
                window.addEventListener('mousemove', handleMouseMove);
                return () => {
                    window.removeEventListener('mousemove', handleMouseMove);
                };
            }, []);

            const [predictionResult, setPredictionResult] = useState(null);

            const handlePrediction = (result) => {
                setPredictionResult(result);
            };

            return (
                <React.Fragment>
                    <Navbar />
                    <HeroSection />
                    <main className="main-content" id="main-tool">
                        <div className="container">
                            <PredictionForm onPrediction={handlePrediction} />
                            {predictionResult && (
                                <div className="result-container">
                                    <h3>Prediction Result</h3>
                                    {predictionResult.error ? (
                                        <p className="high-risk">Error: {predictionResult.error}</p>
                                    ) : (
                                        <div>
                                            <p className={predictionResult.prediction === 1 ? 'high-risk' : 'low-risk'}>
                                                Risk Level: {predictionResult.prediction === 1 ? 'High' : 'Low'}
                                            </p>
                                            <p>
                                                Probability of Failure: {(predictionResult.probability_of_rockfall * 100).toFixed(2)}%
                                            </p>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </main>
                    <Footer />
                </React.Fragment>
            );
        }

        // Render the App to the DOM
        ReactDOM.render(<App />, document.getElementById('root'));

    </script>

</body>
</html>
